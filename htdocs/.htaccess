# Configuration SPA React - JDC Auto
AddDefaultCharset UTF-8
RewriteEngine On

# Permettre l'acc√®s aux fichiers SEO et de test
RewriteCond %{REQUEST_URI} ^/(robots\.txt|sitemap\.xml)$ [OR]
RewriteCond %{REQUEST_URI} ^/(test|test-mobile|diagnostic)\.html$ [OR]
RewriteCond %{REQUEST_URI} ^/api/ [OR]
RewriteCond %{REQUEST_URI} ^/sync/ [OR]
RewriteCond %{REQUEST_URI} ^/install/
RewriteRule ^ - [L]

# Exclure les assets de la redirection (IMPORTANT!)
RewriteCond %{REQUEST_URI} ^/assets/ [OR]
RewriteCond %{REQUEST_URI} \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$
RewriteRule ^ - [L]

# Gestion des fichiers statiques (images, CSS, JS)
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Gestion des dossiers
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Rediriger SEULEMENT les routes React vers index.html
RewriteRule ^(?!assets/).*$ /index.html [L]

# MIME types corrects pour JavaScript modules
<IfModule mod_mime.c>
    AddType application/javascript .js
    AddType text/css .css
    AddType image/svg+xml .svg
</IfModule>

# Cache pour performances (avec exclusion index.html)
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType text/html "access plus 0 seconds"
</IfModule>

# Headers corrects pour modules ES6
<IfModule mod_headers.c>
    <FilesMatch "\.(js)$">
        Header set Content-Type "application/javascript; charset=utf-8"
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
    <FilesMatch "\.(css)$">
        Header set Content-Type "text/css; charset=utf-8"
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
    # Headers pour index.html
    <FilesMatch "^(index\.html)$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </FilesMatch>
</IfModule>

# Compression GZIP
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/css application/javascript
</IfModule>